(self.webpackChunk_kne_components_components_postcat=self.webpackChunk_kne_components_components_postcat||[]).push([[337,451,36],{72879:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var a=n(94679),o=n(19950),r=n(43302),s=n(79149),i=n(70579);const c=e=>{let{baseUrl:t,menuFixed:n,...c}=e;return(0,i.jsx)(o.Kq,{value:{baseUrl:t,...c},children:(0,i.jsxs)(a.Routes,{children:[(0,i.jsx)(a.Route,{index:!0,element:(0,i.jsx)(r.default,{menuFixed:n})}),(0,i.jsx)(a.Route,{path:":id",element:(0,i.jsx)(s.default,{menuFixed:n})}),(0,i.jsx)(a.Route,{path:":id/*",element:(0,i.jsx)(s.default,{menuFixed:n})}),(0,i.jsx)(a.Route,{path:"*",element:(0,i.jsx)(a.Navigate,{to:t})})]})})};c.defaultProps={baseUrl:"/"};const d=c},62667:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var a=n(72879),o=n(73977),r=n(4743),s=n(13050),i=n(70579);const c=(0,r.createInstance)({name:"postcat-project"}),d=(0,r.createInstance)({name:"postcat-openapi-doc"}),l=(0,r.createInstance)({name:"postcat-env"}),p=(0,s.createWithRemoteLoader)({modules:["components-core:File@downloadBlobFile"]})((e=>{let{remoteModules:t,...n}=e;const[r]=t;return(0,i.jsx)(a.default,{...n,apis:{doAddProject:{loader:async e=>{let{data:t}=e;const n=(0,o.v4)(),a=Object.assign({},t,{id:n});return await c.setItem(n,a),a}},getProjectList:{loader:async()=>{const e=await c.keys(),t=await Promise.all(e.map((e=>c.getItem(e))));return{pageData:t,totalCount:t.length}}},doDeleteProject:{loader:async e=>{let{data:t}=e;const n=await c.getItem(t.id);if(!n)throw new Error("\u6570\u636e\u5df2\u8fc7\u671f\u6e05\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5");return n.openApiDocId&&await d.removeItem(n.openApiDocId),n.envIds&&await Promise.all(n.envIds.map((e=>l.removeItem(e)))),await c.removeItem(t.id),{}}},doEditProject:{loader:async e=>{let{data:t}=e;const n=await c.getItem(t.id);if(!n)throw new Error("\u6570\u636e\u5df2\u8fc7\u671f\u6e05\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5");const a=Object.assign({},n,t);return await c.setItem(a.id,a),a}},getProjectDetail:{loader:async e=>{let{params:t}=e;return await c.getItem(t.id)}},getOpenApiDoc:{loader:async e=>{let{params:t}=e;const n=await c.getItem(t.id);return n.openApiDocId?d.getItem(n.openApiDocId):null}},doAddOpenApiDoc:{loader:async e=>{let{data:{projectId:t,...n}}=e;const a=await c.getItem(t);if(!a)throw new Error("\u6570\u636e\u5df2\u8fc7\u671f\u6e05\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5");const r=(0,o.v4)(),s=Object.assign({},n,{id:r});return await d.setItem(r,s),await c.setItem(a.id,Object.assign({},a,{openApiDocId:r})),s}},doEditOpenApiDoc:{loader:async e=>{let{data:t}=e;const n=await d.getItem(t.id);if(!n)throw new Error("\u6570\u636e\u5df2\u8fc7\u671f\u6e05\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5");const a=Object.assign({},n,t);return await d.setItem(n.id,a),a}},getEnvList:{loader:async e=>{let{params:{projectId:t}}=e;const n=await l.keys(),a=(await Promise.all(n.map((e=>l.getItem(e))))).filter((e=>e.projectId===t));return{pageData:a,totalCount:a.length}}},doAddEnv:{loader:async e=>{let{data:t}=e;const n=await c.getItem(t.projectId);if(!n)throw new Error("\u6570\u636e\u5df2\u8fc7\u671f\u6e05\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5");const a=(0,o.v4)(),r=Object.assign({},t,{id:a});return await l.setItem(a,r),n.envIds||(n.envIds=[]),n.envIds.push(a),await c.setItem(n.id,Object.assign({},n)),r}},doEditEnv:{loader:async e=>{let{data:t}=e;const n=await l.getItem(t.id);if(!n)throw new Error("\u6570\u636e\u5df2\u8fc7\u671f\u6e05\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5");const a=Object.assign({},n,t);return await l.setItem(a.id,a),a}},doDeleteEnv:{loader:async e=>{let{data:t}=e;if(!await l.getItem(t.id))throw new Error("\u6570\u636e\u5df2\u8fc7\u671f\u6e05\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5");return await l.removeItem(t.id),null}},excludeApis:{loader:async e=>{let{params:{projectId:t}}=e;const n=await c.getItem(t);if(!n.openApiDocId)throw new Error("\u6570\u636e\u5df2\u8fc7\u671f\u6e05\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5");const a=await d.getItem(n.openApiDocId);if(!(a&&a.content&&a.content.paths&&Object.keys(a.content.paths).length>0))throw new Error("\u6ca1\u6709\u53ef\u5bfc\u51fa\u7684API");return await r(new Blob([JSON.stringify(a.content)],{type:"text/plain"}),"openapi-".concat(a.id,".json")),null}},excludeProject:{loader:async e=>{let{params:{projectId:t}}=e;const n=await c.getItem(t);return n.openApiDocId&&(n.openApiDoc=await d.getItem(n.openApiDocId)),n.envIds&&n.envIds.length>0&&(n.envs=await Promise.all(n.envIds.map((e=>l.getItem(e))))),delete n.openApiDocId,delete n.envIds,await r(new Blob([JSON.stringify(n)],{type:"text/plain"}),"project-".concat(n.id,".json")),null}},includeProject:{loader:async e=>{let{data:{projectId:t,data:n}}=e;const a=await c.getItem(t);a.openApiDocId&&await d.removeItem(a.openApiDocId),a.envIds&&await Promise.all(a.envIds.map((e=>l.removeItem(e))));const r={id:t,name:a.name,description:n.description};if(n.openApiDoc&&n.openApiDoc.content&&n.openApiDoc.content.paths&&Object.keys(n.openApiDoc.content.paths).length>0){const e=(0,o.v4)();r.openApiDocId=e,await d.setItem(e,{id:e,content:n.openApiDoc.content})}return n.envs&&Array.isArray(n.envs)&&n.envs.length>0&&(a.envIds=await Promise.all(n.envs.map((async e=>{const n=(0,o.v4)();return await l.setItem(n,Object.assign({},e,{id:n,projectId:t})),n})))),await c.setItem(t,r),r}}}})}))},43302:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var a=n(13050),o=n(94679),r=n(73884),s=n(55199);const i=()=>[{name:"name",title:"\u9879\u76ee\u540d",type:"mainInfo",hover:!1,primary:!1,fixed:"left"},{name:"description",title:"\u63cf\u8ff0",type:"description"}];var c=n(70579);const d=(0,a.createWithRemoteLoader)({modules:["components-core:FormInfo"]})((e=>{let{remoteModules:t}=e;const[n]=t,{Input:a,TextArea:o}=n.fields;return(0,c.jsx)(n,{column:1,list:[(0,c.jsx)(a,{name:"name",label:"\u9879\u76ee\u540d",rule:"REQ LEN-0-50"}),(0,c.jsx)(o,{name:"description",label:"\u63cf\u8ff0"})]})}));var l=n(19950);const p=(0,a.createWithRemoteLoader)({modules:["components-core:Layout@TablePage","components-core:Global@usePreset","FormInfo@useFormModal"]})((e=>{let{remoteModules:t,...n}=e;const[a,p,m]=t,{apis:u}=(0,l.YY)(),{ajax:I,apis:v}=p(),w=m(),{getProjectList:j,doAddProject:g,doEditProject:f,doDeleteProject:h}=Object.assign({},v.postcat,u),{message:x}=s.App.useApp(),y=(0,r.useRef)(),b=(0,o.useNavigate)(),A=(0,o.useLocation)();return(0,c.jsx)(a,{...Object.assign({},j),ref:y,name:"env",page:{...n,title:"\u9879\u76ee",titleExtra:(0,c.jsx)(s.Space,{children:(0,c.jsx)(s.Button,{type:"primary",onClick:()=>{const e=w({title:"\u6dfb\u52a0\u9879\u76ee",size:"small",formProps:{onSubmit:async t=>{const{data:n}=await I(Object.assign({},g,{data:t}));0===n.code&&(x.success("\u6dfb\u52a0\u6210\u529f"),e.close(),y.current.reload())}},children:(0,c.jsx)(d,{})})},children:"\u6dfb\u52a0"})})},columns:[...i(),{name:"options",title:"\u64cd\u4f5c",type:"options",fixed:"right",valueOf:e=>[{children:"\u67e5\u770b",onClick:()=>{b("".concat(A.pathname,"/").concat(e.id))}},{onClick:()=>{const t=w({title:"\u7f16\u8f91\u9879\u76ee",size:"small",formProps:{data:e,onSubmit:async n=>{const{data:a}=await I(Object.assign({},f,{data:Object.assign({},n,{id:e.id})}));0===a.code&&(x.success("\u4fee\u6539\u6210\u529f"),t.close(),y.current.reload())}},children:(0,c.jsx)(d,{})})},children:"\u7f16\u8f91"},{onClick:async()=>{const{data:t}=await I(Object.assign({},h,{data:{id:e.id}}));0===t.code&&(x.success("\u5220\u9664\u6210\u529f"),y.current.reload())},children:"\u5220\u9664"}]}]})}))},63868:(e,t,n)=>{var a=n(71775),o=n(93211);e.exports=function(e,t,n){(void 0!==n&&!o(e[t],n)||void 0===n&&!(t in e))&&a(e,t,n)}},23253:(e,t,n)=>{var a=n(5538),o=n(63868),r=n(94258),s=n(83223),i=n(46686),c=n(30474),d=n(53737);e.exports=function e(t,n,l,p,m){t!==n&&r(n,(function(r,c){if(m||(m=new a),i(r))s(t,n,c,l,e,p,m);else{var u=p?p(d(t,c),r,c+"",t,n,m):void 0;void 0===u&&(u=r),o(t,c,u)}}),c)}},83223:(e,t,n)=>{var a=n(63868),o=n(44353),r=n(38710),s=n(91980),i=n(20310),c=n(22777),d=n(54052),l=n(76272),p=n(44543),m=n(11629),u=n(46686),I=n(12322),v=n(51268),w=n(53737),j=n(91609);e.exports=function(e,t,n,g,f,h,x){var y=w(e,n),b=w(t,n),A=x.get(b);if(A)a(e,n,A);else{var D=h?h(y,b,n+"",e,t,x):void 0,O=void 0===D;if(O){var P=d(b),E=!P&&p(b),k=!P&&!E&&v(b);D=b,P||E||k?d(y)?D=y:l(y)?D=s(y):E?(O=!1,D=o(b,!0)):k?(O=!1,D=r(b,!0)):D=[]:I(b)||c(b)?(D=y,c(y)?D=j(y):u(y)&&!m(y)||(D=i(b))):O=!1}O&&(x.set(b,D),f(D,b,g,h,x),x.delete(b)),a(e,n,D)}}},55647:(e,t,n)=>{var a=n(33279),o=n(55636),r=n(46350);e.exports=function(e,t){return r(o(e,t,a),e+"")}},84570:(e,t,n)=>{var a=n(55647),o=n(60929);e.exports=function(e){return a((function(t,n){var a=-1,r=n.length,s=r>1?n[r-1]:void 0,i=r>2?n[2]:void 0;for(s=e.length>3&&"function"==typeof s?(r--,s):void 0,i&&o(n[0],n[1],i)&&(s=r<3?void 0:s,r=1),t=Object(t);++a<r;){var c=n[a];c&&e(t,c,a,s)}return t}))}},60929:(e,t,n)=>{var a=n(93211),o=n(6571),r=n(69194),s=n(46686);e.exports=function(e,t,n){if(!s(n))return!1;var i=typeof t;return!!("number"==i?o(n)&&r(t,n.length):"string"==i&&t in n)&&a(n[t],e)}},53737:e=>{e.exports=function(e,t){if(("constructor"!==t||"function"!==typeof e[t])&&"__proto__"!=t)return e[t]}},76272:(e,t,n)=>{var a=n(6571),o=n(22761);e.exports=function(e){return o(e)&&a(e)}},34677:(e,t,n)=>{var a=n(23253),o=n(84570)((function(e,t,n){a(e,t,n)}));e.exports=o},91609:(e,t,n)=>{var a=n(96614),o=n(30474);e.exports=function(e){return a(e,o(e))}}}]);
//# sourceMappingURL=337.a9ae2fc6.chunk.js.map